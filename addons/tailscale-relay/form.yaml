name: Tailscale
tabs:
- name: main
  context:
    type: cluster
    config:
      group: core
      version: v1
      resource: services
  label: Services
  sections:
  - name: section_one
    contents: 
    - type: heading
      label: Available Services
    - type: subtitle
      label: The services below can be reached through your Tailscale VPN.
    - type: service-ip-list
      value: |
        .items[] | {
          name: .metadata.labels["app.kubernetes.io/instance"],
          type: .metadata.labels["app.kubernetes.io/name"],
          managedBy: .metadata.labels["app.kubernetes.io/managed-by"],
          namespace: .metadata.namespace,
          clusterIP: .spec.clusterIP,
        } | select(.clusterIP!="None" and .managedBy=="Helm") | {
          name: .name,
          type: .type,
          namespace: .namespace,
          clusterIP: .clusterIP,
        }
- name: tailscale
  label: Tailscale Settings
  sections:
  - name: main
    contents:
    - type: heading
      label: Tailscale Auth Key
    - type: subtitle
      label: Provide a Tailscale auth key for this relay node to use. You can generate an auth key from the Tailscale dashboard by going to "Settings" -> "Auth Keys" and generating a one-off key. Auth keys will expire after 90 days by default. To disable key expiry consult the Tailscale docs.
    - type: string-input
      required: true
      variable: config.authKey
      placeholder: "ex: tskey-0a1b2c3d4e5f6g7h8i9j"
    - type: heading
      label: Subnet routes
    - type: subtitle
      label: Specify the IP range of the subnet you would like to advertise.
    - type: string-input
      required: true
      variable: config.ipRange
      placeholder: "ex: 10.123.456.0/20"